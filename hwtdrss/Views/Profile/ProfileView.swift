//
//  ProfileView.swift
//  hwtdrss
//
//  Created by –ö–∏—Ä–∏–ª–ª –ö–æ—á–µ—Ç–∫–æ–≤ on 11.09.2022.
//

import Foundation
import SwiftUI

// –£ —Ç–µ–±—è –±—ã–ª–∏ –æ–±—ä—è–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
// –¢–∞–∫ –Ω–µ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å –Ω–∏–∫–æ–≥–¥–∞))
// –î–∞–∂–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ

// –í—Å–µ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–∞—Ä—ã–Ω–µ –º–æ–¥—É–ª–∏ –Ω–∞–¥–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–∞–ø–∫–∞–º
// —Å–º–æ—Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ, —á—Ç–æ —è —Ç–µ–±–µ —Å–æ–∑–¥–∞–ª
// –†–µ–∫–æ–º–µ–Ω–¥—É—é —Ç–∞–∫ –∂–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö macOS —Ö–æ—Ç–∫–µ–∏ –¥–ª—è XCode –ø–æ–¥
//
// Sort by Name
// Sort by Type
//
// –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–ª—ã –∏ –ø–∞–ø–∫–∏ –≤ –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
// –ê - –∞–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç—å

struct ProfileView: View {
    // MARK: - Dependencies
    
    // –ï—Å–ª–∏ –∫–ª–∞—Å—Å –∏–º–µ–µ—Ç –≤–º–µ—à–Ω—é—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (–æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –¥—Ä—É–≥–æ–º—É –∫–ª–∞—Å—Å—É –∑–∞ –¥–∞–Ω–Ω—ã–µ–º–∏)
    // –¢–æ –ª—É—á—à–µ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–¥ –æ–¥–Ω–æ–π –º–∞—Ä–∫–æ–π MARK: - Dependencies ‚òùÔ∏è
    // –î–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –ª–∏—à—å –æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    // –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è –µ—â–µ))
    
    let weatherService = WeatherService()
    
    // MARK: - Properties
    
    // –í—Å–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —É–¥–æ–±–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–¥ —Å–≤–æ–µ–π –º–∞—Ä–∫–æ–π
    // –í–æ–æ–±—â–µ –¥–ª—è –º–∞—Ä–æ–∫ —Å—É–ø–µ—Ä —É–¥–æ–±–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–Ω–∏–ø–ø–µ—Ç—ã
    
    let serverURL = URL(string: "https://api.weatherapi.com/v1/current.json?key=c5cc45f41cc743758af110518212507&q=chelyabinsk&days=1&aqi=yes&alerts=yes&lang=ru")!

    // –û—Å–Ω–æ–≤–Ω–∞—è –æ—à–∏–±–∫–∞ –±—ã–ª–∞ —Ç—É—Ç - @State —Å–≤–æ–π—Å—Ç–≤–æ —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞–¥–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å View
    @State private var weather: WeatherModel? = nil

    var body: some View {
        NavigationView {
            VStack {
                
                // –õ—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –∞ –Ω–µ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π
                Text("–°–µ–≥–æ–¥–Ω—è –Ω–∞ —É–ª–∏—Ü–µ –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ \(weather?.feelLikeTempString ?? "Undefined")")
                    .font(.system(size: 24))
                    .frame(maxHeight: .infinity, alignment: .topLeading)
                    .padding(50)
                
                Text("–°–æ–≤–µ—Ç—É—é –Ω–∞–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ –∏–ª–∏ —Ç—Ä–µ–Ω—á, –∞ –ø–æ–¥ –Ω–µ–≥–æ —Å—Ç–æ–∏—Ç –Ω–∞–¥–µ—Ç—å —Ç–µ–ø–ª—ã–π —Å–≤–∏—Ç–µ—Ä üß•")
                    .font(.system(size: 16))
                    .frame(maxHeight: .infinity, alignment: .center)
                    .padding(20)
            }
            .navigationTitle("–ß—Ç–æ –Ω–∞–¥–µ—Ç—å?")
            .navigationBarTitleDisplayMode(.large)
            .frame(maxWidth: .infinity, maxHeight: .infinity)
            
            // –í–æ—Ç —Ç–µ–±–µ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞
            
            .background(Color(hex: "#4d4aed") ?? Color.indigo)
        }
        .onAppear {
            // –ö–∞–∂–µ—Ç—Å—è –Ω–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ, –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–º—ã–∫–∞–Ω–∏–µ —Ç–∞–∫
            // –Ω–µ—Ç —Å–º—ã—Å–ª–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥, –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–π–º–µ—Ç 10 —Å—Ç—Ä–æ–∫
            weatherService.obtainWeather(
                for: serverURL
            ) { result in
                switch result {
                case let .success(response):
                    weather = response

                case let .failure(error):
                    // –¢—É—Ç —è –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—Ä–∞–≤–Ω—è–ª –∫ nil —á—Ç–æ –±—ã –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–±—ã—á–Ω–æ –Ω–∞–¥–æ
                    // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤ UI
                    // –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Ç—ã –∏ —Ç–∞–∫ –∑–Ω–∞–µ—à—å, –Ω–æ –Ω–∞–ø–æ–º–Ω—é.
                    weather = nil
                    print("–û—à–∏–±–∫–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã: \(error.localizedDescription)")
                }
            }
        }
    }
}

struct ProfileView_Previews: PreviewProvider {
    static var previews: some View {
        ProfileView()
    }
}
